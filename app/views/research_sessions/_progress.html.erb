<% preview ||= false %>
<%= content_for :progress do %>
<div class="progress screen-only">
  <ol class="progress-bar">

    <%#
      Loop through each step from the wizard
      Figure out where the user is in the flow
      to indicate how far in the journey they are and
      give the user a link to that step based on if
      they have already visited it or not.
    %>
    <% ResearchSession::Steps.instance.step_keys.each do |this_step| %>
      <li
        class="progress__stage
          <%= 'is-complete' if @research_session.reached_step?(this_step) %>
          <%= 'is-active' if defined?(step) && this_step == step %>">
        <span class="progress__stage-title">
          <% if preview || (defined?(step) && this_step != step && @research_session.reached_step?(this_step)) %>
            <%= link_to this_step.to_s.humanize, research_session_question_path(@research_session.slug, this_step) %>
          <% else %>
            <%= this_step.to_s.humanize %>
          <% end %>
        </span>
      </li>
    <% end %>

    <%#
      If the user has completed the last step, provide
      a link to the preview section
    %>
    <li class="progress__stage
          <%= 'is-complete' if @research_session.reached_step?(ResearchSession::Steps.instance.step_keys.last) %>
          <%= 'is-active' if preview %>">
      <span class="progress__stage-title">
        <% if !preview && @research_session.reached_step?(ResearchSession::Steps.instance.step_keys.last) %>
          <%= link_to t('application.preview_step_name'), research_session_preview_path(@research_session.slug) %>
        <% else %>
          <%= t('application.preview_step_name') %>
        <% end %>
      </span>
    </li>
  </ol>
</div>
<% end %>
